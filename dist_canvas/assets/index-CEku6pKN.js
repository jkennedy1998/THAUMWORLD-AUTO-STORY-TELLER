(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=e(s);fetch(s.href,c)}})();function w(r){const t=r.trim().replace(/^#/,"");if(t.length!==6)throw new Error(`Invalid hex color: ${r}`);const e=Number.parseInt(t.slice(0,2),16),o=Number.parseInt(t.slice(2,4),16),s=Number.parseInt(t.slice(4,6),16);if(!Number.isFinite(e)||!Number.isFinite(o)||!Number.isFinite(s))throw new Error(`Invalid hex color: ${r}`);return{r:e,g:o,b:s}}const Y=[{index:0,name:"off_black",hex:"#120a1a",rgb:w("#120a1a")},{index:1,name:"off_white",hex:"#feffe5",rgb:w("#feffe5")},{index:2,name:"pumpkin",hex:"#e36325",rgb:w("#e36325")},{index:3,name:"pale_green",hex:"#e2e990",rgb:w("#e2e990")},{index:4,name:"deep_red",hex:"#3d2329",rgb:w("#3d2329")},{index:5,name:"deep_green",hex:"#2d3a26",rgb:w("#2d3a26")},{index:6,name:"deep_blue",hex:"#2a2a41",rgb:w("#2a2a41")},{index:7,name:"vivid_purple",hex:"#422490",rgb:w("#422490")},{index:8,name:"medium_purple",hex:"#7f37bc",rgb:w("#7f37bc")},{index:9,name:"light_purple",hex:"#a544ff",rgb:w("#a544ff")},{index:10,name:"pale_purple",hex:"#debfe0",rgb:w("#debfe0")},{index:11,name:"gray_purple",hex:"#ab8ab5",rgb:w("#ab8ab5")},{index:12,name:"vivid_magenta",hex:"#ff26a8",rgb:w("#ff26a8")},{index:13,name:"light_magenta",hex:"#ff69a9",rgb:w("#ff69a9")},{index:14,name:"vivid_red",hex:"#dc3426",rgb:w("#dc3426")},{index:15,name:"vivid_maroon",hex:"#b21535",rgb:w("#b21535")},{index:16,name:"vivid_brown",hex:"#a8561a",rgb:w("#a8561a")},{index:17,name:"light_brown",hex:"#c4702b",rgb:w("#c4702b")},{index:18,name:"light_orange",hex:"#ea9827",rgb:w("#ea9827")},{index:19,name:"light_red",hex:"#f26657",rgb:w("#f26657")},{index:20,name:"vivid_yellow",hex:"#ffc62f",rgb:w("#ffc62f")},{index:21,name:"pale_yellow",hex:"#fff3b3",rgb:w("#fff3b3")},{index:22,name:"gray_green",hex:"#8c9d4f",rgb:w("#8c9d4f")},{index:23,name:"medium_green",hex:"#a9c448",rgb:w("#a9c448")},{index:24,name:"vivid_green",hex:"#4f9d35",rgb:w("#4f9d35")},{index:25,name:"vivid_cyan",hex:"#8bf5c6",rgb:w("#8bf5c6")},{index:26,name:"light_blue",hex:"#4dc6e4",rgb:w("#4dc6e4")},{index:27,name:"medium_blue",hex:"#4477ff",rgb:w("#4477ff")},{index:28,name:"vivid_blue",hex:"#2749d0",rgb:w("#2749d0")},{index:29,name:"dark_gray",hex:"#404863",rgb:w("#404863")},{index:30,name:"medium_gray",hex:"#787d8b",rgb:w("#787d8b")},{index:31,name:"light_gray",hex:"#9da5ae",rgb:w("#9da5ae")},{index:32,name:"pale_gray",hex:"#e0e8d0",rgb:w("#e0e8d0")},{index:33,name:"gray_yellow",hex:"#ac9d7c",rgb:w("#ac9d7c")},{index:34,name:"pale_orange",hex:"#fad5af",rgb:w("#fad5af")},{index:35,name:"gray_orange",hex:"#c5b5a8",rgb:w("#c5b5a8")},{index:36,name:"gray_red",hex:"#d27979",rgb:w("#d27979")}],re=new Map(Y.map(r=>[r.name,r]));new Map(Y.map(r=>[r.index,r]));function u(r){const t=re.get(r);if(!t)throw new Error(`Unknown color name: ${r}`);return t}const ne=u("off_white").rgb,se="regular",J=" ",W=3;function ie(r){const t=typeof r=="number"?Math.trunc(r):W;return Number.isFinite(t)?Math.max(0,Math.min(7,t)):W}function G(r){return Number.isFinite(r)?Math.max(0,Math.min(255,Math.round(r))):0}function N(r){const t=r.char.charAt(0),e=t!==""?t:J,o=r.rgb?{r:G(r.rgb.r),g:G(r.rgb.g),b:G(r.rgb.b)}:ne,s=r.style??se,c=ie(r.weight_index);return{char:e,rgb:o,style:s,weight_index:c}}function F(r,t,e,o){return!Number.isInteger(e)||!Number.isInteger(o)||e<0||e>=r||o<0||o>=t?null:(t-1-o)*r+e}function oe(r,t,e){if(!Number.isInteger(r)||r<=0)throw new Error("Canvas width must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new Error("Canvas height must be a positive integer");const o=N({char:J}),s=Array.from({length:r*t},()=>({...o})),c={width:r,height:t,get(l,n){const _=F(r,t,l,n);if(_!==null)return s[_]},set(l,n,_){const h=F(r,t,l,n);if(h===null)return;const i=N({...s[h],..._});s[h]=i},clear_rect(l){c.fill_rect(l,{char:" "})},fill_rect(l,n){const _=N(n),h=Math.min(l.x0,l.x1),i=Math.max(l.x0,l.x1),a=Math.min(l.y0,l.y1),y=Math.max(l.y0,l.y1);for(let d=a;d<=y;d++)for(let x=h;x<=i;x++){const v=F(r,t,x,d);v!==null&&(s[v]={..._})}},draw_line(l,n,_,h,i){const a=N(i);let y=Math.trunc(l),d=Math.trunc(n);const x=Math.trunc(_),v=Math.trunc(h),f=Math.abs(x-y),g=Math.abs(v-d),b=y<x?1:-1,k=d<v?1:-1;let p=f-g;for(;;){const O=F(r,t,y,d);if(O!==null&&(s[O]={...a}),y===x&&d===v)break;const M=2*p;M>-g&&(p-=g,y+=b),M<f&&(p+=f,d+=k)}}};return c}function ae(r,t){r.fill_rect({x0:0,y0:0,x1:r.width-1,y1:r.height-1},{char:" "});for(const e of t)e.Draw(r)}function K(r){return r.x1-r.x0+1}function S(r){return r.y1-r.y0+1}function X(r,t,e){return t>=r.x0&&t<=r.x1&&e>=r.y0&&e<=r.y1}var Q={};const le=typeof process<"u"&&Q,ce=Number(le?Q.DEBUG_LEVEL??3:3);function z(...r){ce<2||console.warn(...r)}const _e=[100,200,300,400,500,600,700,800];function he(r){const t=typeof r=="number"?Math.trunc(r):3;return Number.isFinite(t)?Math.max(0,Math.min(7,t)):3}class de{canvas_el;ctx;key_sink;engine_canvas;modules;grid_width;grid_height;font_family;base_font_size_px;base_line_height_mult;base_letter_spacing_mult;weight_index_to_css;scale=1;raf_id=null;last_tile=null;focused_owner=null;pending_single_click=null;wheel_accum_dx=0;wheel_accum_dy=0;wheel_pending=null;hover_owner=null;capture_owner=null;down_owner=null;down_tile=null;dragging=!1;DBLCLICK_MS=180;DBLCLICK_TILE_RADIUS=1;DRAG_THRESHOLD_TILES=1;constructor(t){this.canvas_el=t.canvas;const e=this.canvas_el.getContext("2d");if(!e)throw new Error("2d canvas context not available");this.ctx=e,this.grid_width=t.grid_width,this.grid_height=t.grid_height,this.font_family=t.font_family,this.base_font_size_px=t.base_font_size_px,this.base_line_height_mult=t.base_line_height_mult,this.base_letter_spacing_mult=t.base_letter_spacing_mult,this.weight_index_to_css=t.weight_index_to_css??_e,this.modules=t.modules,this.engine_canvas=oe(this.grid_width,this.grid_height),this.key_sink=t.key_sink??this.ensure_key_sink(),this.attach_events()}set_scale(t){this.scale=t,this.resize_to_grid()}get_scale(){return this.scale}set_modules(t){this.modules=t}start(){this.resize_to_grid(),this.tick()}stop(){this.raf_id!==null&&cancelAnimationFrame(this.raf_id),this.raf_id=null}ensure_key_sink(){let t=document.getElementById("key_sink");return t||(t=document.createElement("textarea"),t.id="key_sink",t.setAttribute("autocomplete","off"),t.setAttribute("autocorrect","off"),t.setAttribute("autocapitalize","off"),t.setAttribute("spellcheck","false"),t.style.position="fixed",t.style.left="-9999px",t.style.top="0px",t.style.width="1px",t.style.height="1px",t.style.opacity="0",document.body.appendChild(t),z("[mono_ui] key_sink element was missing; created one automatically")),t}focus_key_sink(){this.key_sink.focus({preventScroll:!0})}make_pointer_event(t,e,o,s,c,l){const n={pointer_id:0,kind:t,x:e,y:o,buttons:s.buttons,button:s.button,shift:s.shiftKey,ctrl:s.ctrlKey,alt:s.altKey,meta:s.metaKey};return this.last_tile&&(n.prev_x=this.last_tile.x,n.prev_y=this.last_tile.y),c!==void 0&&(n.cell=c),l!==void 0&&(n.click_count=l),n}make_drag_event(t,e,o,s,c){if(!this.down_tile)throw new Error("drag event without down_tile");const l=this.last_tile??{x:this.down_tile.x,y:this.down_tile.y},n={pointer_id:0,kind:t,x:e,y:o,start_x:this.down_tile.x,start_y:this.down_tile.y,dx:e-this.down_tile.x,dy:o-this.down_tile.y,step_dx:e-l.x,step_dy:o-l.y,buttons:s};return c!==void 0&&(n.cell=c),n}drag_distance_tiles(t,e){return this.down_tile?Math.max(Math.abs(t-this.down_tile.x),Math.abs(e-this.down_tile.y)):0}route_to_top_module(t,e){for(let o=this.modules.length-1;o>=0;o--){const s=this.modules[o];if(s&&X(s.rect,t,e))return s}}get_metrics(){const t=this.base_font_size_px*this.scale,e=t*this.base_line_height_mult,o=t*this.base_letter_spacing_mult;this.ctx.font=`400 ${t}px "${this.font_family}"`;const c=this.ctx.measureText("M").width+o;return{font_size_px:t,line_height_px:e,letter_spacing_px:o,tile_w:c,tile_h:e}}resize_to_grid(){const{tile_w:t,tile_h:e}=this.get_metrics();this.canvas_el.width=Math.ceil(t*this.grid_width),this.canvas_el.height=Math.ceil(e*this.grid_height),this.canvas_el.style.width=`${this.canvas_el.width}px`,this.canvas_el.style.height=`${this.canvas_el.height}px`}draw_canvas(t){const{font_size_px:e,tile_w:o,tile_h:s}=this.get_metrics();this.ctx.clearRect(0,0,this.canvas_el.width,this.canvas_el.height),this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(let c=0;c<t.height;c++)for(let l=0;l<t.width;l++){const n=t.get(l,c);if(!n)continue;const _=(t.height-1-c)*s,h=he(n.weight_index),i=this.weight_index_to_css[h]??400;this.ctx.font=`${i} ${e}px "${this.font_family}"`,this.ctx.fillStyle=`rgb(${n.rgb.r},${n.rgb.g},${n.rgb.b})`;const a=l*o+o/2,y=_+s/2;this.ctx.fillText(n.char,a,y)}}mouse_to_tile(t){const{tile_w:e,tile_h:o}=this.get_metrics(),s=this.canvas_el.getBoundingClientRect(),c=t.clientX-s.left,l=t.clientY-s.top,n=Math.floor(c/e),_=Math.floor(l/o),h=this.grid_height-1-_;return n<0||n>=this.grid_width||h<0||h>=this.grid_height?null:{x:n,y:h}}dispatch_global_keydown(t){return t.key==="Escape"?(this.focused_owner?.OnBlur?.(),this.focused_owner=null,!0):!1}attach_events(){this.canvas_el.addEventListener("contextmenu",t=>{t.preventDefault()}),this.canvas_el.addEventListener("mousemove",t=>{const e=this.mouse_to_tile(t);if(!e){!this.capture_owner&&this.hover_owner?.OnPointerLeave&&this.last_tile&&this.hover_owner.OnPointerLeave(this.make_pointer_event("leave",this.last_tile.x,this.last_tile.y,t,this.engine_canvas.get(this.last_tile.x,this.last_tile.y))),this.hover_owner=null,this.last_tile=null;return}const o=this.route_to_top_module(e.x,e.y)??null,s=this.make_pointer_event("move",e.x,e.y,t,this.engine_canvas.get(e.x,e.y));if(this.capture_owner){if(this.capture_owner.OnPointerMove?.(s),this.down_tile){const c=this.drag_distance_tiles(e.x,e.y);!this.dragging&&c>=this.DRAG_THRESHOLD_TILES&&(this.dragging=!0,this.capture_owner.OnDragStart?.(this.make_drag_event("drag_start",e.x,e.y,t.buttons,this.engine_canvas.get(e.x,e.y)))),this.dragging&&this.capture_owner.OnDragMove?.(this.make_drag_event("drag_move",e.x,e.y,t.buttons,this.engine_canvas.get(e.x,e.y)))}this.last_tile=e;return}o!==this.hover_owner&&(this.hover_owner?.OnPointerLeave?.({...s,kind:"leave"}),o?.OnPointerEnter?.({...s,kind:"enter"}),this.hover_owner=o),o?.OnPointerMove?.(s),this.last_tile=e}),this.canvas_el.addEventListener("mouseleave",t=>{!this.capture_owner&&this.hover_owner&&this.last_tile&&this.hover_owner.OnPointerLeave?.(this.make_pointer_event("leave",this.last_tile.x,this.last_tile.y,t,this.engine_canvas.get(this.last_tile.x,this.last_tile.y))),this.hover_owner=null,this.last_tile=null}),this.canvas_el.addEventListener("mousedown",t=>{t.preventDefault(),this.focus_key_sink();const e=this.mouse_to_tile(t);if(!e)return;const o=this.route_to_top_module(e.x,e.y)??null;this.down_owner=o,this.down_tile=e,this.dragging=!1,this.capture_owner=o,o?.Focusable&&o!==this.focused_owner&&(this.focused_owner?.OnBlur?.(),this.focused_owner=o,this.focused_owner?.OnFocus?.()),o?.OnPointerDown?.(this.make_pointer_event("down",e.x,e.y,t,this.engine_canvas.get(e.x,e.y)))}),this.canvas_el.addEventListener("wheel",t=>{t.preventDefault();const e=this.mouse_to_tile(t);e&&(this.wheel_accum_dx+=t.deltaX,this.wheel_accum_dy+=t.deltaY,this.wheel_pending={x:e.x,y:e.y,delta_mode:t.deltaMode,mods:{shift:t.shiftKey,ctrl:t.ctrlKey,alt:t.altKey,meta:t.metaKey}})},{passive:!1}),this.canvas_el.addEventListener("mouseup",t=>{const e=this.mouse_to_tile(t);if(!e){this.capture_owner=null,this.down_owner=null,this.down_tile=null,this.dragging=!1;return}const o=this.route_to_top_module(e.x,e.y)??null,s=this.capture_owner??o;if(s?.OnPointerUp?.(this.make_pointer_event("up",e.x,e.y,t,this.engine_canvas.get(e.x,e.y))),this.dragging&&s&&s.OnDragEnd?.(this.make_drag_event("drag_end",e.x,e.y,t.buttons,this.engine_canvas.get(e.x,e.y))),!this.dragging&&this.down_owner&&s&&this.down_owner===s&&X(s.rect,e.x,e.y)){const c=performance.now(),l=t.button,n=this.pending_single_click;!!n&&c<=n.run_at_ms&&n.target.id===s.id&&n.button===l&&Math.max(Math.abs(e.x-n.x),Math.abs(e.y-n.y))<=this.DBLCLICK_TILE_RADIUS?(this.pending_single_click=null,s.OnClick?.(this.make_pointer_event("click",e.x,e.y,t,this.engine_canvas.get(e.x,e.y),2))):this.pending_single_click={run_at_ms:c+this.DBLCLICK_MS,target:s,button:l,x:e.x,y:e.y,ev:t}}this.capture_owner=null,this.down_owner=null,this.down_tile=null,this.dragging=!1}),this.key_sink.addEventListener("keydown",t=>{for(let e=this.modules.length-1;e>=0;e--){const o=this.modules[e];if(o&&o.OnGlobalKeyDown){o.OnGlobalKeyDown(t);break}}this.dispatch_global_keydown(t)||this.focused_owner?.OnKeyDown?.(t)}),this.key_sink.addEventListener("keyup",t=>{this.focused_owner?.OnKeyUp?.(t)}),this.key_sink.addEventListener("beforeinput",t=>{if(!this.focused_owner?.OnTextInput)return;t.preventDefault();const e=t.data;typeof e=="string"&&e.length>0&&this.focused_owner.OnTextInput(e)})}tick(){const t=performance.now();if(this.pending_single_click&&t>=this.pending_single_click.run_at_ms){const e=this.pending_single_click;this.pending_single_click=null,e.target.OnClick?.(this.make_pointer_event("click",e.x,e.y,e.ev,this.engine_canvas.get(e.x,e.y),1))}if(ae(this.engine_canvas,this.modules),this.wheel_pending){const{x:e,y:o,delta_mode:s,mods:c}=this.wheel_pending;this.route_to_top_module(e,o)?.OnWheel?.({x:e,y:o,delta_x:this.wheel_accum_dx,delta_y:this.wheel_accum_dy,delta_mode:s,...c}),this.wheel_accum_dx=0,this.wheel_accum_dy=0,this.wheel_pending=null}this.draw_canvas(this.engine_canvas),this.raf_id=requestAnimationFrame(()=>this.tick())}}function ge(r){return{id:r.id,rect:r.rect,Draw(t){const e={char:r.char,...r.style!==void 0?{style:r.style}:{},...r.rgb!==void 0?{rgb:r.rgb}:{},...r.weight_index!==void 0?{weight_index:r.weight_index}:{}};t.fill_rect(r.rect,e)}}}function L(r){const t=r.rect;let e=!1,o=!1,s=0;const c=20;function l(i){return i<0?0:i>7?7:i|0}function n(){return l(r.base_weight_index??3)}function _(){const i=n();let a=0;return s>0?a=2:o?a=-1:e&&(a=1),l(i+a)}function h(i){const a=t.y0+Math.floor((t.y1-t.y0)/2),y=r.label,d=t.x0+Math.max(0,Math.floor((t.x1-t.x0+1-y.length)/2));for(let x=0;x<y.length;x++){const v=d+x;if(v>t.x1)break;const f=y.charAt(x);f&&i.set(v,a,{char:f,rgb:r.rgb,style:"regular",weight_index:_()})}}return{id:r.id,rect:t,Focusable:r.Focusable??!0,Draw(i){s>0&&s--,r.bg&&i.fill_rect(t,{char:r.bg.char,rgb:r.bg.rgb,style:"regular"}),e&&i.set(t.x0,t.y1,{char:"H",rgb:r.rgb,style:"regular",weight_index:5}),o&&i.set(t.x0+1,t.y1,{char:"P",rgb:r.rgb,style:"regular",weight_index:7}),h(i)},OnPointerEnter(){e=!0},OnPointerLeave(){e=!1},OnPointerDown(i){i.button===0&&(o=!0)},OnPointerUp(){o=!1},OnDragStart(){},OnClick(i){s=c,r.OnPress?.(i)}}}function ue(r,t){return{x0:r.x0+t,y0:r.y0+t,x1:r.x1-t,y1:r.y1-t}}function j(r,t,e,o=3,s={},c={}){const l=s.corner??"+",n=s.h??"-",_=s.v??"|";for(let i=t.x0;i<=t.x1;i++)r.set(i,t.y1,{char:n,rgb:e,style:"regular",weight_index:o}),r.set(i,t.y0,{char:n,rgb:e,style:"regular",weight_index:o});for(let i=t.y0;i<=t.y1;i++)r.set(t.x0,i,{char:_,rgb:e,style:"regular",weight_index:o}),r.set(t.x1,i,{char:_,rgb:e,style:"regular",weight_index:o});r.set(t.x0,t.y0,{char:l,rgb:e,style:"regular",weight_index:o}),r.set(t.x1,t.y0,{char:l,rgb:e,style:"regular",weight_index:o}),r.set(t.x0,t.y1,{char:l,rgb:e,style:"regular",weight_index:o}),r.set(t.x1,t.y1,{char:l,rgb:e,style:"regular",weight_index:o});const h=Math.floor((t.x0+t.x1)/2);return c.top&&r.set(h,t.y1,{char:c.top,rgb:e,style:"regular",weight_index:Math.min(7,o+2)}),c.bottom&&r.set(h,t.y0,{char:c.bottom,rgb:e,style:"regular",weight_index:Math.min(7,o+2)}),ue(t,1)}function H(r,t,e){return Math.max(t,Math.min(e,r))}function fe(r,t){const e=[];if(t<=0||!Array.isArray(r))return e;const o=n=>Array.from(n),s=n=>o(n).length,c=(n,_,h)=>o(n).slice(_,h).join(""),l=(n,_)=>{if(n.length===0){e.push({text:"",sender:_});return}const h=n.split(/\s+/).filter(d=>d.length>0);let i="";const a=()=>{e.push({text:i,sender:_}),i=""},y=d=>{const x=s(d);if(x>t){i.length>0&&a();let f=d;for(;s(f)>t;){const g=Math.max(1,t-1);e.push({text:c(f,0,g)+"-",sender:_}),f=c(f,g)}i=f;return}if(i.length===0){i=d;return}s(i)+1+x<=t?i=i+" "+d:(a(),i=d)};for(const d of h)y(d);h.length===0?e.push({text:"",sender:_}):i.length>0&&e.push({text:i,sender:_})};for(let n=0;n<r.length;n++){const _=r[n]??"",h=typeof _=="string"?_:_.content,i=typeof _=="string"?void 0:_.sender,a=h.split(`
`);for(let y=0;y<a.length;y++)l(a[y]??"",i);n!==r.length-1&&e.push({text:"",sender:i})}return e}function U(r){let t=0,e=-1,o=-1,s=[];function c(){const h=r.base_weight_index??3;return H(h|0,0,7)}function l(h){const i=r.get_source();if(i.rev===e&&h===o)return;const a=S(n()),y=Math.max(0,s.length-a),d=e===-1?!0:t>=y;e=i.rev,o=h,s=fe(i.messages,h);const x=Math.max(0,s.length-a);t=d?x:H(t,0,x)}function n(){return{x0:r.rect.x0+1,y0:r.rect.y0+1,x1:r.rect.x1-1,y1:r.rect.y1-1}}function _(h){const i=n(),a=S(i),y=Math.max(0,s.length-a);t=H(t+h,0,y)}return{id:r.id,rect:r.rect,Focusable:!0,Draw(h){const i=r.border_rgb??u("light_gray").rgb,a=r.text_rgb??u("off_white").rgb,y=r.hint_rgb??u("pale_yellow").rgb,d=c();r.bg&&h.fill_rect(r.rect,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:d});const x=n(),v=K(x),f=S(x);if(v<=0||f<=0){j(h,r.rect,i,d,{corner:"+",h:"-",v:"|"});return}l(v);const g=s.length,b=t>0,k=t+f<g,p={};b&&(p.top="^"),k&&(p.bottom="v"),j(h,r.rect,i,d,{corner:"+",h:"-",v:"|"},p),r.bg?h.fill_rect(x,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:d}):h.fill_rect(x,{char:" ",style:"regular",weight_index:d});for(let O=0;O<f;O++){const M=t+O,D=s[M],A=D?.text??"",m=D?.sender;let E=a;m==="hint"?E=y:m==="npc"?E=r.npc_rgb??a:m==="state"&&(E=r.state_rgb??a);const T=x.y1-O,$=Array.from(A);for(let R=0;R<v;R++){const ee=$[R]??" ",te=x.x0+R;h.set(te,T,{char:ee,rgb:E,style:"regular",weight_index:d})}}},OnWheel(h){const i=h.delta_y;if(i===0)return;const a=i>0?1:-1;_(a)}}}function B(r,t,e){return Math.max(t,Math.min(e,r))}function V(r,t){const e=[];if(t<=0)return e;const o=_=>Array.from(_),s=_=>o(_).length,c=(_,h,i)=>o(_).slice(h,i).join(""),l=_=>{if(_.length===0){e.push("");return}const h=_.split(/\s+/).filter(d=>d.length>0);let i="";const a=()=>{e.push(i),i=""},y=d=>{const x=s(d);if(x>t){i.length>0&&a();let f=d;for(;s(f)>t;){const g=Math.max(1,t-1);e.push(c(f,0,g)+"-"),f=c(f,g)}i=f;return}if(i.length===0){i=d;return}s(i)+1+x<=t?i=i+" "+d:(a(),i=d)};for(const d of h)y(d);h.length===0?e.push(""):i.length>0&&e.push(i)},n=r.split(`
`);for(const _ of n)l(_??"");return e}function be(r){const t=r.text_rgb??u("off_white").rgb,e=r.border_rgb??u("light_gray").rgb,o=r.cursor_rgb??u("off_white").rgb,s=typeof r.base_weight_index=="number"?B(Math.trunc(r.base_weight_index),0,7):3;let c=!1,l="";function n(){const a=Array.from(l);a.length!==0&&(a.pop(),l=a.join(""),r.on_change?.(l))}function _(a){const y=a.replace(/\t/g,"    ");l=l+y,r.on_change?.(l)}function h(){const a=l;a.length!==0&&(r.on_submit(r.target_id,a),l="",r.on_change?.(l))}function i(a,y,d){a.set(y,d,{char:"â–Œ",rgb:o,style:"regular",weight_index:s})}return r.bind_submit?.(h),{id:r.id,rect:r.rect,Focusable:!0,OnFocus(){c=!0},OnBlur(){c=!1},OnPointerDown(a){},OnTextInput(a){c&&a&&_(a)},OnKeyDown(a){if(c){if(a.key==="Backspace"){a.preventDefault(),a.stopPropagation(),n();return}if(a.key==="Enter"){a.preventDefault(),a.stopPropagation(),a.shiftKey?_(`
`):h();return}}},Draw(a){const y=r.rect,d={x0:y.x0+1,y0:y.y0+1,x1:y.x1-1,y1:y.y1-1};r.bg&&a.fill_rect(y,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:s}),j(a,y,e);const x=K(d),v=S(d),f=l.length>0?l:r.placeholder??"",g=V(f,x),b=Math.max(0,g.length-v);r.bg?a.fill_rect(d,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:s}):a.fill_rect(d,{char:" ",style:"regular",weight_index:s});for(let k=0;k<v;k++){const p=g[b+k]??"",O=Array.from(p),M=d.y1-k;for(let D=0;D<x;D++){const A=O[D]??" ",m=l.length===0&&(r.placeholder??"").length>0;a.set(d.x0+D,M,{char:A,rgb:m?u("medium_gray").rgb:t,style:"regular",weight_index:s})}}if(c){const k=V(l,x),p=Math.max(0,k.length-v),O=Math.max(0,k.length-1),M=B(O-p,0,v-1),D=k[O]??"",A=d.y1-M,m=d.x0+B(Array.from(D).length,0,x-1);i(a,m,A)}}}}function ye(r,t,e){return Math.max(t,Math.min(e,r))}function xe(r){let t=!1,e=!1;function o(){const n=r.base_weight_index??3;return ye(n|0,0,7)}function s(n,_,h,i,a,y){const d=Array.from(i);for(let x=0;x<d.length;x++){const v=d[x]??" ";n.set(_+x,h,{char:v,rgb:a,style:"regular",weight_index:y})}}function c(){return{x0:r.rect.x0+1,y0:r.rect.y0+1,x1:r.rect.x1-1,y1:r.rect.y0+3}}function l(n,_,h){return _>=n.x0&&_<=n.x1&&h>=n.y0&&h<=n.y1}return{id:r.id,rect:r.rect,Focusable:!0,Draw(n){const _=r.get_state(),h=o(),i=r.rect;r.bg&&n.fill_rect(i,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:h});const a=_.disabled?r.dim_rgb:r.text_rgb,y=_.disabled?":3":_.dice_label,d=_.last_roll.length>0?_.last_roll:"no roll",x=_.spinner||"|";s(n,i.x0+1,i.y1-1,`roll ${x}`,a,h+1);const v=K(i)-2,f=d.length>v?d.slice(0,v):d;s(n,i.x0+1,i.y1-2,f,a,h);const g=c(),b=_.disabled?r.dim_rgb:r.text_rgb;n.fill_rect(g,{char:"-",rgb:r.border_rgb,style:"regular",weight_index:h});const k=y,p=g.x0+Math.max(0,Math.floor((K(g)-k.length)/2)),O=g.y0+Math.floor(S(g)/2),M=_.disabled?0:h+(t?1:0);s(n,p,O,k,b,M),e&&n.set(g.x0,g.y1,{char:"P",rgb:b,style:"regular",weight_index:h+2})},OnPointerEnter(){t=!0},OnPointerLeave(){t=!1,e=!1},OnPointerDown(n){n.button===0&&l(c(),n.x,n.y)&&(e=!0)},OnPointerUp(){e=!1},OnClick(n){if(n.button!==0)return;const _=r.get_state();_.disabled||!_.roll_id||l(c(),n.x,n.y)&&r.on_roll(_.roll_id)}}}function me(r){return(r??"").toLowerCase().split(/[^a-z0-9]+/g).map(e=>e.trim()).filter(e=>e.length>0)}function we(r,t){const e=[];for(let o=2;o<=t;o++)for(let s=0;s+o<=r.length;s++)e.push(r.slice(s,s+o).join(" "));return e}const pe=[{verb:"COMMUNICATE",keywords:["say","ask","tell","speak","talk","hello","hi","hey","greet","whisper","shout","yell","signal"],phrases:["talk to","speak to","ask about"]},{verb:"INSPECT",keywords:["inspect","look","examine","search","scan","survey","check","observe"],phrases:["look around","look at","examine the"]},{verb:"MOVE",keywords:["move","go","walk","run","travel","head","approach","enter","leave","north","south","east","west"],phrases:["go to","walk to","head to"]},{verb:"ATTACK",keywords:["attack","hit","strike","stab","shoot","kill","punch","slash","swing"],phrases:["attack the","hit the"]},{verb:"USE",keywords:["use","light","ignite","drink","eat","equip","unequip","wield","wear","consume"],phrases:["pick up","put on"]},{verb:"HELP",keywords:["help","assist","aid"]},{verb:"DEFEND",keywords:["defend","block","parry"]},{verb:"DODGE",keywords:["dodge","evade","duck"]},{verb:"GRAPPLE",keywords:["grapple","grab","wrestle"]},{verb:"CRAFT",keywords:["craft","make","build","forge","brew"]},{verb:"SLEEP",keywords:["sleep","rest","nap"]},{verb:"REPAIR",keywords:["repair","fix","mend"]},{verb:"WORK",keywords:["work","labor"]},{verb:"GUARD",keywords:["guard","watch"]},{verb:"HOLD",keywords:["hold","ready","prepare"]}];function q(r){const t=me(r);if(t.length===0)return{verb:null};const e=new Set(t),o=we(t,3),s=new Set(o),c=[];for(const i of pe){if(Array.isArray(i.phrases))for(const a of i.phrases)s.has(a)&&c.push({verb:i.verb,score:3,matched:a,mode:"phrase"});for(const a of i.keywords)e.has(a)&&c.push({verb:i.verb,score:2,matched:a,mode:"token"})}if(c.length===0)return{verb:null};c.sort((i,a)=>a.score-i.score);const l=c[0],n=l.score,_=c.filter(i=>i.score===n),h=Array.from(new Set(_.map(i=>i.verb)));return h.length>1?{verb:null,ambiguous:!0,candidates:h.map(i=>{const a=_.find(y=>y.verb===i);return{verb:i,score:a.score,matched:a.matched}})}:{verb:l.verb,matched_keyword:l.matched,matched_mode:l.mode}}const P={font_family:"Martian Mono",base_font_size_px:10,base_line_height_mult:1.5,base_letter_spacing_mult:.08,weight_index_to_css:[100,200,300,400,500,600,700,800],grid_width:120,grid_height:44,interpreter_endpoint:"http://localhost:8787/api/input",interpreter_log_endpoint:"http://localhost:8787/api/log",interpreter_status_endpoint:"http://localhost:8787/api/status",interpreter_targets_endpoint:"http://localhost:8787/api/targets",roller_status_endpoint:"http://localhost:8787/api/roller_status",roller_roll_endpoint:"http://localhost:8787/api/roll",selected_data_slot:1,input_actor_id:"henry_actor"};function ve(){const r=u("off_white").rgb,t=u("deep_red").rgb,e={text_windows:new Map,status_override:{until_ms:0,lines:[]},controls:{override_intent:null,override_cost:null,selected_target:null,draft:"",suggested_intent:null,suggested_matched:null,last_infer_timer:null,targets:[],region_label:null},roller:{spinner:"|",last_roll:"",dice_label:"D20",disabled:!0,roll_id:null}};function o(f,g){const b=e.text_windows.get(f);b?(b.messages=[...g],b.rev++):e.text_windows.set(f,{messages:[...g],rev:1})}function s(f,g){const b=e.text_windows.get(f);b?(b.messages.push(g),b.rev++):e.text_windows.set(f,{messages:[g],rev:1})}const c=[],l=new Map;function n(f,g){e.status_override.until_ms=Date.now()+g,e.status_override.lines=[...f];const b=e.text_windows.get("status");b&&b.rev++}function _(f){c.push(f)}async function h(){const f=c.map(async g=>{try{const b=await g.fetch_messages();o(g.window_id,b)}catch(b){z("[mono_ui] failed to refresh window feed",g.window_id,b)}});f.push((async()=>{try{const g=await fetch(P.roller_status_endpoint);if(!g.ok)return;const b=await g.json();if(!b.ok||!b.status)return;e.roller.spinner=String(b.status.spinner??"|"),e.roller.last_roll=String(b.status.last_player_roll??""),e.roller.dice_label=String(b.status.dice_label??"D20"),e.roller.disabled=!!(b.status.disabled??!0),e.roller.roll_id=b.status.roll_id??null}catch{}})()),f.push((async()=>{try{const g=`${P.interpreter_targets_endpoint}?slot=${P.selected_data_slot}&actor_id=${P.input_actor_id}`,b=await fetch(g);if(!b.ok)return;const k=await b.json();if(!k.ok)return;e.controls.targets=Array.isArray(k.targets)?k.targets:[],e.controls.region_label=typeof k.region=="string"?k.region:null;const p=[];p.push(`[region] ${e.controls.region_label??"unknown"}`);const O=e.controls.override_intent??e.controls.suggested_intent;O?p.push(`[intent] ${O}`):p.push("[intent] (none)");const M=e.controls.override_cost;p.push(`[cost] ${M??"(auto)"}`),e.controls.selected_target?p.push(`[target] ${e.controls.selected_target}`):p.push("[target] (none)"),p.push(""),p.push("Targets (type @name or /target name):");for(const D of e.controls.targets)D.type==="npc"&&p.push(`- ${D.label} (${D.ref})`);o("targets",p)}catch{}})()),await Promise.all(f)}function i(f){h(),setInterval(()=>{h()},f)}async function a(f){try{const g=f.trim();if(g.toLowerCase().startsWith("/target ")){const A=g.slice(8).trim().toLowerCase(),m=e.controls.targets.find(E=>E.type==="npc"&&(E.label.toLowerCase()===A||E.ref.toLowerCase()===`npc.${A}`));e.controls.selected_target=m?m.ref:null,n([`target set: ${m?m.label:"(cleared)"}`],1200);return}if(g.toLowerCase()==="/target"){e.controls.selected_target=null,n(["target cleared"],1200);return}let b=e.controls.selected_target,k=f;const p=g.match(/^@([a-z0-9_\-]+)\s+(.*)$/i);if(p&&p[1]&&p[2]){const A=p[1].toLowerCase(),m=e.controls.targets.find(E=>E.type==="npc"&&(E.ref.toLowerCase()===`npc.${A}`||E.label.toLowerCase()===A));m&&(b=m.ref,k=p[2])}const O=q(k);!e.controls.override_intent&&!O.verb&&(n(["your message does not contain an action type hint"],900),await new Promise(A=>setTimeout(A,900)));const M=await fetch(P.interpreter_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:k,sender:P.input_actor_id,intent_verb:e.controls.override_intent??void 0,action_cost:e.controls.override_cost??void 0,target_ref:b??void 0})});if(!M.ok)throw new Error(`HTTP ${M.status}`);const D=await M.json();D.ok&&D.id&&(l.set(D.id,f),h()),n(["waiting for actor response"],900)}catch(g){z("[mono_ui] failed to send to interpreter",g),s("log","[system] failed to reach interpreter")}}async function y(f){const g=await fetch(`${P.interpreter_log_endpoint}?slot=${f}`);if(!g.ok)throw new Error(`HTTP ${g.status}`);const b=await g.json();if(!b.ok||!Array.isArray(b.messages))return[];const k=[...b.messages].reverse(),p=new Set,O=new Map,M=k.filter(m=>{if(!m?.id||p.has(m.id))return!1;p.add(m.id);const E=(m.sender??"").toLowerCase();if(E==="j")return!0;if(E==="renderer_ai"){const I=m.correlation_id??"none",T=(m.content??"").trim(),$=O.get(I);return O.set(I,T),!(!T||$!==void 0&&$===T)}return!!(E==="hint"||m.type==="user_input"||E.startsWith("npc.")||E==="state_applier")});for(const m of M)l.has(m.id)&&l.delete(m.id);const D=M.map(m=>{const E=(m.sender??"").toLowerCase();return E==="hint"?{content:`ðŸ’¡ ${m.content}`,sender:"hint"}:E==="renderer_ai"?{content:`ASSISTANT: ${m.content}`,sender:"assistant"}:E==="j"?{content:`J: ${m.content}`,sender:"user"}:E.startsWith("npc.")?{content:`${E.replace("npc.","").toUpperCase()}: ${m.content}`,sender:"npc"}:E==="state_applier"?{content:`[STATE] ${m.content}`,sender:"state"}:{content:`${m.sender}: ${m.content}`,sender:"system"}}),A=Array.from(l.values()).map(m=>({content:`J: ${m}`,sender:"user"}));return[...D,...A]}async function d(f){if(e.status_override.until_ms>Date.now()&&e.status_override.lines.length>0)return[...e.status_override.lines];const g=await fetch(`${P.interpreter_status_endpoint}?slot=${f}`);if(!g.ok)throw new Error(`HTTP ${g.status}`);const b=await g.json();return!b.ok||!b.status?.line?[""]:[b.status.line]}window.THAUM_UI={set_text_window_messages:o,append_text_window_message:s},o("log",["This is a text window. It wraps words onto new lines.","If a word is tooooooooolongtobefitononeline it will hyphenate-and-continue.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","hey! :3"]);let x=null;const v=[ge({id:"bg",rect:{x0:0,y0:0,x1:P.grid_width-1,y1:P.grid_height-1},char:".",rgb:t,style:"regular"}),U({id:"log",rect:{x0:1,y0:13,x1:86,y1:36},get_source:()=>e.text_windows.get("log")??{messages:[],rev:0},border_rgb:u("light_gray").rgb,text_rgb:u("off_white").rgb,bg:{char:" ",rgb:u("off_black").rgb},base_weight_index:3,hint_rgb:u("pale_yellow").rgb,npc_rgb:u("pumpkin").rgb,state_rgb:u("dark_gray").rgb}),U({id:"status",rect:{x0:1,y0:38,x1:86,y1:42},get_source:()=>e.text_windows.get("status")??{messages:[],rev:0},border_rgb:u("medium_gray").rgb,text_rgb:u("pale_gray").rgb,bg:{char:" ",rgb:u("off_black").rgb},base_weight_index:3}),be({id:"input",rect:{x0:1,y0:1,x1:86,y1:11},target_id:"log",on_submit:(f,g)=>{a(g)},on_change:f=>{e.controls.draft=f,e.controls.last_infer_timer&&clearTimeout(e.controls.last_infer_timer),e.controls.last_infer_timer=window.setTimeout(()=>{const g=q(e.controls.draft);e.controls.suggested_intent=g.verb?g.verb:null,e.controls.suggested_matched=g.matched_keyword??null;const b=[];b.push(`[suggested] ${e.controls.suggested_intent??"(none)"}`),e.controls.suggested_matched&&b.push(`[matched] ${e.controls.suggested_matched}`),b.push(`[override intent] ${e.controls.override_intent??"(none)"}`),b.push(`[override cost] ${e.controls.override_cost??"(none)"}`),o("controls",b)},1e3)},bind_submit:f=>{x=f},border_rgb:u("light_gray").rgb,text_rgb:u("off_white").rgb,cursor_rgb:u("off_white").rgb,bg:{char:" ",rgb:u("off_black").rgb},base_weight_index:3,placeholder:"Typeâ€¦ (Enter=send, Shift+Enter=new line, Backspace=delete)"}),L({id:"btn_send",rect:{x0:88,y0:1,x1:100,y1:3},label:"send",rgb:u("pale_orange").rgb,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){x?.()}}),U({id:"controls",rect:{x0:88,y0:4,x1:118,y1:11},get_source:()=>e.text_windows.get("controls")??{messages:[],rev:0},border_rgb:u("medium_gray").rgb,text_rgb:u("pale_gray").rgb,bg:{char:" ",rgb:u("off_black").rgb},base_weight_index:3}),U({id:"targets",rect:{x0:88,y0:20,x1:118,y1:36},get_source:()=>e.text_windows.get("targets")??{messages:[],rev:0},border_rgb:u("light_gray").rgb,text_rgb:u("off_white").rgb,bg:{char:" ",rgb:u("off_black").rgb},base_weight_index:3}),L({id:"cost_free",rect:{x0:102,y0:1,x1:106,y1:3},label:"FREE",rgb:u("pale_orange").rgb,bg:{char:".",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_cost="FREE",n(["action cost: FREE"],800)}}),L({id:"cost_part",rect:{x0:107,y0:1,x1:112,y1:3},label:"PART",rgb:u("pale_orange").rgb,bg:{char:".",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_cost="PARTIAL",n(["action cost: PARTIAL"],800)}}),L({id:"cost_full",rect:{x0:113,y0:1,x1:118,y1:3},label:"FULL",rgb:u("pale_orange").rgb,bg:{char:".",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_cost="FULL",n(["action cost: FULL"],800)}}),L({id:"cost_ext",rect:{x0:113,y0:4,x1:118,y1:6},label:"EXT",rgb:u("pale_orange").rgb,bg:{char:".",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_cost="EXTENDED",n(["action cost: EXTENDED"],800)}}),L({id:"verb_use",rect:{x0:88,y0:7,x1:93,y1:9},label:"USE",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="USE",n(["intent: USE"],800)}}),L({id:"verb_atk",rect:{x0:94,y0:7,x1:99,y1:9},label:"ATK",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="ATTACK",n(["intent: ATTACK"],800)}}),L({id:"verb_hlp",rect:{x0:100,y0:7,x1:105,y1:9},label:"HLP",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="HELP",n(["intent: HELP"],800)}}),L({id:"verb_def",rect:{x0:106,y0:7,x1:112,y1:9},label:"DEF",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="DEFEND",n(["intent: DEFEND"],800)}}),L({id:"verb_grp",rect:{x0:113,y0:7,x1:118,y1:9},label:"GRP",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="GRAPPLE",n(["intent: GRAPPLE"],800)}}),L({id:"verb_ins",rect:{x0:88,y0:10,x1:93,y1:12},label:"INS",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="INSPECT",n(["intent: INSPECT"],800)}}),L({id:"verb_com",rect:{x0:94,y0:10,x1:101,y1:12},label:"COM",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="COMMUNICATE",n(["intent: COMMUNICATE"],800)}}),L({id:"verb_mov",rect:{x0:102,y0:10,x1:107,y1:12},label:"MOV",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="MOVE",n(["intent: MOVE"],800)}}),L({id:"verb_ddg",rect:{x0:108,y0:10,x1:112,y1:12},label:"DDG",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="DODGE",n(["intent: DODGE"],800)}}),L({id:"verb_crf",rect:{x0:113,y0:10,x1:118,y1:12},label:"CRF",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="CRAFT",n(["intent: CRAFT"],800)}}),L({id:"verb_slp",rect:{x0:88,y0:13,x1:93,y1:15},label:"SLP",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="SLEEP",n(["intent: SLEEP"],800)}}),L({id:"verb_rpr",rect:{x0:94,y0:13,x1:99,y1:15},label:"RPR",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="REPAIR",n(["intent: REPAIR"],800)}}),L({id:"verb_wrk",rect:{x0:100,y0:13,x1:105,y1:15},label:"WRK",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="WORK",n(["intent: WORK"],800)}}),L({id:"verb_grd",rect:{x0:106,y0:13,x1:112,y1:15},label:"GRD",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="GUARD",n(["intent: GUARD"],800)}}),L({id:"verb_hld",rect:{x0:113,y0:13,x1:118,y1:15},label:"HLD",rgb:r,bg:{char:"-",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent="HOLD",n(["intent: HOLD"],800)}}),L({id:"verb_clear",rect:{x0:88,y0:16,x1:99,y1:18},label:"CLEAR",rgb:u("pale_yellow").rgb,bg:{char:".",rgb:u("dark_gray").rgb},OnPress(){e.controls.override_intent=null,e.controls.override_cost=null,n(["overrides cleared"],800)}}),xe({id:"roller",rect:{x0:88,y0:38,x1:118,y1:42},get_state:()=>e.roller,on_roll:async f=>{await fetch(P.roller_roll_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roll_id:f})})},text_rgb:u("pale_orange").rgb,dim_rgb:u("medium_gray").rgb,border_rgb:u("dark_gray").rgb,bg:{char:" ",rgb:u("off_black").rgb},base_weight_index:3})];return _({window_id:"log",fetch_messages:()=>y(P.selected_data_slot)}),_({window_id:"status",fetch_messages:()=>d(P.selected_data_slot)}),o("controls",["[suggested] (none)","[override intent] (none)","[override cost] (none)"]),o("targets",["[region] (loading...)","Targets will appear here."]),{modules:v,start_window_feed_polling:i}}const Z=document.getElementById("mono_canvas");if(!Z)throw new Error("mono_canvas element not found");const{modules:ke,start_window_feed_polling:Ee}=ve(),C=new de({canvas:Z,grid_width:P.grid_width,grid_height:P.grid_height,font_family:P.font_family,base_font_size_px:P.base_font_size_px,base_line_height_mult:P.base_line_height_mult,base_letter_spacing_mult:P.base_letter_spacing_mult,weight_index_to_css:P.weight_index_to_css,modules:ke});Ee(1e3);C.start();window.addEventListener("keydown",r=>{r.key==="1"&&C.set_scale(.5),r.key==="2"&&C.set_scale(1),r.key==="3"&&C.set_scale(1.5),r.key==="4"&&C.set_scale(2)});
