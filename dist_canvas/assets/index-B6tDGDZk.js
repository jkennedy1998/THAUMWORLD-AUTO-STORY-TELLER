(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const _ of s)if(_.type==="childList")for(const c of _.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const _={};return s.integrity&&(_.integrity=s.integrity),s.referrerPolicy&&(_.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?_.credentials="include":s.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function a(s){if(s.ep)return;s.ep=!0;const _=e(s);fetch(s.href,_)}})();function w(r){const t=r.trim().replace(/^#/,"");if(t.length!==6)throw new Error(`Invalid hex color: ${r}`);const e=Number.parseInt(t.slice(0,2),16),a=Number.parseInt(t.slice(2,4),16),s=Number.parseInt(t.slice(4,6),16);if(!Number.isFinite(e)||!Number.isFinite(a)||!Number.isFinite(s))throw new Error(`Invalid hex color: ${r}`);return{r:e,g:a,b:s}}const Z=[{index:0,name:"off_black",hex:"#120a1a",rgb:w("#120a1a")},{index:1,name:"off_white",hex:"#feffe5",rgb:w("#feffe5")},{index:2,name:"pumpkin",hex:"#e36325",rgb:w("#e36325")},{index:3,name:"pale_green",hex:"#e2e990",rgb:w("#e2e990")},{index:4,name:"deep_red",hex:"#3d2329",rgb:w("#3d2329")},{index:5,name:"deep_green",hex:"#2d3a26",rgb:w("#2d3a26")},{index:6,name:"deep_blue",hex:"#2a2a41",rgb:w("#2a2a41")},{index:7,name:"vivid_purple",hex:"#422490",rgb:w("#422490")},{index:8,name:"medium_purple",hex:"#7f37bc",rgb:w("#7f37bc")},{index:9,name:"light_purple",hex:"#a544ff",rgb:w("#a544ff")},{index:10,name:"pale_purple",hex:"#debfe0",rgb:w("#debfe0")},{index:11,name:"gray_purple",hex:"#ab8ab5",rgb:w("#ab8ab5")},{index:12,name:"vivid_magenta",hex:"#ff26a8",rgb:w("#ff26a8")},{index:13,name:"light_magenta",hex:"#ff69a9",rgb:w("#ff69a9")},{index:14,name:"vivid_red",hex:"#dc3426",rgb:w("#dc3426")},{index:15,name:"vivid_maroon",hex:"#b21535",rgb:w("#b21535")},{index:16,name:"vivid_brown",hex:"#a8561a",rgb:w("#a8561a")},{index:17,name:"light_brown",hex:"#c4702b",rgb:w("#c4702b")},{index:18,name:"light_orange",hex:"#ea9827",rgb:w("#ea9827")},{index:19,name:"light_red",hex:"#f26657",rgb:w("#f26657")},{index:20,name:"vivid_yellow",hex:"#ffc62f",rgb:w("#ffc62f")},{index:21,name:"pale_yellow",hex:"#fff3b3",rgb:w("#fff3b3")},{index:22,name:"gray_green",hex:"#8c9d4f",rgb:w("#8c9d4f")},{index:23,name:"medium_green",hex:"#a9c448",rgb:w("#a9c448")},{index:24,name:"vivid_green",hex:"#4f9d35",rgb:w("#4f9d35")},{index:25,name:"vivid_cyan",hex:"#8bf5c6",rgb:w("#8bf5c6")},{index:26,name:"light_blue",hex:"#4dc6e4",rgb:w("#4dc6e4")},{index:27,name:"medium_blue",hex:"#4477ff",rgb:w("#4477ff")},{index:28,name:"vivid_blue",hex:"#2749d0",rgb:w("#2749d0")},{index:29,name:"dark_gray",hex:"#404863",rgb:w("#404863")},{index:30,name:"medium_gray",hex:"#787d8b",rgb:w("#787d8b")},{index:31,name:"light_gray",hex:"#9da5ae",rgb:w("#9da5ae")},{index:32,name:"pale_gray",hex:"#e0e8d0",rgb:w("#e0e8d0")},{index:33,name:"gray_yellow",hex:"#ac9d7c",rgb:w("#ac9d7c")},{index:34,name:"pale_orange",hex:"#fad5af",rgb:w("#fad5af")},{index:35,name:"gray_orange",hex:"#c5b5a8",rgb:w("#c5b5a8")},{index:36,name:"gray_red",hex:"#d27979",rgb:w("#d27979")}],se=new Map(Z.map(r=>[r.name,r]));new Map(Z.map(r=>[r.index,r]));function o(r){const t=se.get(r);if(!t)throw new Error(`Unknown color name: ${r}`);return t}const ie=o("off_white").rgb,oe="regular",ee=" ",q=3;function ae(r){const t=typeof r=="number"?Math.trunc(r):q;return Number.isFinite(t)?Math.max(0,Math.min(7,t)):q}function z(r){return Number.isFinite(r)?Math.max(0,Math.min(255,Math.round(r))):0}function K(r){const t=r.char.charAt(0),e=t!==""?t:ee,a=r.rgb?{r:z(r.rgb.r),g:z(r.rgb.g),b:z(r.rgb.b)}:ie,s=r.style??oe,_=ae(r.weight_index);return{char:e,rgb:a,style:s,weight_index:_}}function G(r,t,e,a){return!Number.isInteger(e)||!Number.isInteger(a)||e<0||e>=r||a<0||a>=t?null:(t-1-a)*r+e}function le(r,t,e){if(!Number.isInteger(r)||r<=0)throw new Error("Canvas width must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new Error("Canvas height must be a positive integer");const a=K({char:ee}),s=Array.from({length:r*t},()=>({...a})),_={width:r,height:t,get(c,n){const g=G(r,t,c,n);if(g!==null)return s[g]},set(c,n,g){const d=G(r,t,c,n);if(d===null)return;const i=K({...s[d],...g});s[d]=i},clear_rect(c){_.fill_rect(c,{char:" "})},fill_rect(c,n){const g=K(n),d=Math.min(c.x0,c.x1),i=Math.max(c.x0,c.x1),l=Math.min(c.y0,c.y1),y=Math.max(c.y0,c.y1);for(let h=l;h<=y;h++)for(let x=d;x<=i;x++){const k=G(r,t,x,h);k!==null&&(s[k]={...g})}},draw_line(c,n,g,d,i){const l=K(i);let y=Math.trunc(c),h=Math.trunc(n);const x=Math.trunc(g),k=Math.trunc(d),b=Math.abs(x-y),u=Math.abs(k-h),f=y<x?1:-1,v=h<k?1:-1;let p=b-u;for(;;){const E=G(r,t,y,h);if(E!==null&&(s[E]={...l}),y===x&&h===k)break;const A=2*p;A>-u&&(p-=u,y+=f),A<b&&(p+=b,h+=v)}}};return _}function ce(r,t){r.fill_rect({x0:0,y0:0,x1:r.width-1,y1:r.height-1},{char:" "});for(const e of t)e.Draw(r)}function B(r){return r.x1-r.x0+1}function U(r){return r.y1-r.y0+1}function Y(r,t,e){return t>=r.x0&&t<=r.x1&&e>=r.y0&&e<=r.y1}var te={};const _e=typeof process<"u"&&te,ge=Number(_e?te.DEBUG_LEVEL??3:3);function V(...r){ge<2||console.warn(...r)}const de=[100,200,300,400,500,600,700,800];function he(r){const t=typeof r=="number"?Math.trunc(r):3;return Number.isFinite(t)?Math.max(0,Math.min(7,t)):3}class ue{canvas_el;ctx;key_sink;engine_canvas;modules;grid_width;grid_height;font_family;base_font_size_px;base_line_height_mult;base_letter_spacing_mult;weight_index_to_css;scale=1;raf_id=null;last_tile=null;focused_owner=null;pending_single_click=null;wheel_accum_dx=0;wheel_accum_dy=0;wheel_pending=null;hover_owner=null;capture_owner=null;down_owner=null;down_tile=null;dragging=!1;DBLCLICK_MS=180;DBLCLICK_TILE_RADIUS=1;DRAG_THRESHOLD_TILES=1;constructor(t){this.canvas_el=t.canvas;const e=this.canvas_el.getContext("2d");if(!e)throw new Error("2d canvas context not available");this.ctx=e,this.grid_width=t.grid_width,this.grid_height=t.grid_height,this.font_family=t.font_family,this.base_font_size_px=t.base_font_size_px,this.base_line_height_mult=t.base_line_height_mult,this.base_letter_spacing_mult=t.base_letter_spacing_mult,this.weight_index_to_css=t.weight_index_to_css??de,this.modules=t.modules,this.engine_canvas=le(this.grid_width,this.grid_height),this.key_sink=t.key_sink??this.ensure_key_sink(),this.attach_events()}set_scale(t){this.scale=t,this.resize_to_grid()}get_scale(){return this.scale}set_modules(t){this.modules=t}start(){this.resize_to_grid(),this.tick()}stop(){this.raf_id!==null&&cancelAnimationFrame(this.raf_id),this.raf_id=null}ensure_key_sink(){let t=document.getElementById("key_sink");return t||(t=document.createElement("textarea"),t.id="key_sink",t.setAttribute("autocomplete","off"),t.setAttribute("autocorrect","off"),t.setAttribute("autocapitalize","off"),t.setAttribute("spellcheck","false"),t.style.position="fixed",t.style.left="-9999px",t.style.top="0px",t.style.width="1px",t.style.height="1px",t.style.opacity="0",document.body.appendChild(t),V("[mono_ui] key_sink element was missing; created one automatically")),t}focus_key_sink(){this.key_sink.focus({preventScroll:!0})}make_pointer_event(t,e,a,s,_,c){const n={pointer_id:0,kind:t,x:e,y:a,buttons:s.buttons,button:s.button,shift:s.shiftKey,ctrl:s.ctrlKey,alt:s.altKey,meta:s.metaKey};return this.last_tile&&(n.prev_x=this.last_tile.x,n.prev_y=this.last_tile.y),_!==void 0&&(n.cell=_),c!==void 0&&(n.click_count=c),n}make_drag_event(t,e,a,s,_){if(!this.down_tile)throw new Error("drag event without down_tile");const c=this.last_tile??{x:this.down_tile.x,y:this.down_tile.y},n={pointer_id:0,kind:t,x:e,y:a,start_x:this.down_tile.x,start_y:this.down_tile.y,dx:e-this.down_tile.x,dy:a-this.down_tile.y,step_dx:e-c.x,step_dy:a-c.y,buttons:s};return _!==void 0&&(n.cell=_),n}drag_distance_tiles(t,e){return this.down_tile?Math.max(Math.abs(t-this.down_tile.x),Math.abs(e-this.down_tile.y)):0}route_to_top_module(t,e){for(let a=this.modules.length-1;a>=0;a--){const s=this.modules[a];if(s&&Y(s.rect,t,e))return s}}get_metrics(){const t=this.base_font_size_px*this.scale,e=t*this.base_line_height_mult,a=t*this.base_letter_spacing_mult;this.ctx.font=`400 ${t}px "${this.font_family}"`;const _=this.ctx.measureText("M").width+a;return{font_size_px:t,line_height_px:e,letter_spacing_px:a,tile_w:_,tile_h:e}}resize_to_grid(){const{tile_w:t,tile_h:e}=this.get_metrics();this.canvas_el.width=Math.ceil(t*this.grid_width),this.canvas_el.height=Math.ceil(e*this.grid_height),this.canvas_el.style.width=`${this.canvas_el.width}px`,this.canvas_el.style.height=`${this.canvas_el.height}px`}draw_canvas(t){const{font_size_px:e,tile_w:a,tile_h:s}=this.get_metrics();this.ctx.clearRect(0,0,this.canvas_el.width,this.canvas_el.height),this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(let _=0;_<t.height;_++)for(let c=0;c<t.width;c++){const n=t.get(c,_);if(!n)continue;const g=(t.height-1-_)*s,d=he(n.weight_index),i=this.weight_index_to_css[d]??400;this.ctx.font=`${i} ${e}px "${this.font_family}"`,this.ctx.fillStyle=`rgb(${n.rgb.r},${n.rgb.g},${n.rgb.b})`;const l=c*a+a/2,y=g+s/2;this.ctx.fillText(n.char,l,y)}}mouse_to_tile(t){const{tile_w:e,tile_h:a}=this.get_metrics(),s=this.canvas_el.getBoundingClientRect(),_=t.clientX-s.left,c=t.clientY-s.top,n=Math.floor(_/e),g=Math.floor(c/a),d=this.grid_height-1-g;return n<0||n>=this.grid_width||d<0||d>=this.grid_height?null:{x:n,y:d}}dispatch_global_keydown(t){return t.key==="Escape"?(this.focused_owner?.OnBlur?.(),this.focused_owner=null,!0):!1}attach_events(){this.canvas_el.addEventListener("contextmenu",t=>{t.preventDefault()}),this.canvas_el.addEventListener("mousemove",t=>{const e=this.mouse_to_tile(t);if(!e){!this.capture_owner&&this.hover_owner?.OnPointerLeave&&this.last_tile&&this.hover_owner.OnPointerLeave(this.make_pointer_event("leave",this.last_tile.x,this.last_tile.y,t,this.engine_canvas.get(this.last_tile.x,this.last_tile.y))),this.hover_owner=null,this.last_tile=null;return}const a=this.route_to_top_module(e.x,e.y)??null,s=this.make_pointer_event("move",e.x,e.y,t,this.engine_canvas.get(e.x,e.y));if(this.capture_owner){if(this.capture_owner.OnPointerMove?.(s),this.down_tile){const _=this.drag_distance_tiles(e.x,e.y);!this.dragging&&_>=this.DRAG_THRESHOLD_TILES&&(this.dragging=!0,this.capture_owner.OnDragStart?.(this.make_drag_event("drag_start",e.x,e.y,t.buttons,this.engine_canvas.get(e.x,e.y)))),this.dragging&&this.capture_owner.OnDragMove?.(this.make_drag_event("drag_move",e.x,e.y,t.buttons,this.engine_canvas.get(e.x,e.y)))}this.last_tile=e;return}a!==this.hover_owner&&(this.hover_owner?.OnPointerLeave?.({...s,kind:"leave"}),a?.OnPointerEnter?.({...s,kind:"enter"}),this.hover_owner=a),a?.OnPointerMove?.(s),this.last_tile=e}),this.canvas_el.addEventListener("mouseleave",t=>{!this.capture_owner&&this.hover_owner&&this.last_tile&&this.hover_owner.OnPointerLeave?.(this.make_pointer_event("leave",this.last_tile.x,this.last_tile.y,t,this.engine_canvas.get(this.last_tile.x,this.last_tile.y))),this.hover_owner=null,this.last_tile=null}),this.canvas_el.addEventListener("mousedown",t=>{t.preventDefault(),this.focus_key_sink();const e=this.mouse_to_tile(t);if(!e)return;const a=this.route_to_top_module(e.x,e.y)??null;this.down_owner=a,this.down_tile=e,this.dragging=!1,this.capture_owner=a,a?.Focusable&&a!==this.focused_owner&&(this.focused_owner?.OnBlur?.(),this.focused_owner=a,this.focused_owner?.OnFocus?.()),a?.OnPointerDown?.(this.make_pointer_event("down",e.x,e.y,t,this.engine_canvas.get(e.x,e.y)))}),this.canvas_el.addEventListener("wheel",t=>{t.preventDefault();const e=this.mouse_to_tile(t);e&&(this.wheel_accum_dx+=t.deltaX,this.wheel_accum_dy+=t.deltaY,this.wheel_pending={x:e.x,y:e.y,delta_mode:t.deltaMode,mods:{shift:t.shiftKey,ctrl:t.ctrlKey,alt:t.altKey,meta:t.metaKey}})},{passive:!1}),this.canvas_el.addEventListener("mouseup",t=>{const e=this.mouse_to_tile(t);if(!e){this.capture_owner=null,this.down_owner=null,this.down_tile=null,this.dragging=!1;return}const a=this.route_to_top_module(e.x,e.y)??null,s=this.capture_owner??a;if(s?.OnPointerUp?.(this.make_pointer_event("up",e.x,e.y,t,this.engine_canvas.get(e.x,e.y))),this.dragging&&s&&s.OnDragEnd?.(this.make_drag_event("drag_end",e.x,e.y,t.buttons,this.engine_canvas.get(e.x,e.y))),!this.dragging&&this.down_owner&&s&&this.down_owner===s&&Y(s.rect,e.x,e.y)){const _=performance.now(),c=t.button,n=this.pending_single_click;!!n&&_<=n.run_at_ms&&n.target.id===s.id&&n.button===c&&Math.max(Math.abs(e.x-n.x),Math.abs(e.y-n.y))<=this.DBLCLICK_TILE_RADIUS?(this.pending_single_click=null,s.OnClick?.(this.make_pointer_event("click",e.x,e.y,t,this.engine_canvas.get(e.x,e.y),2))):this.pending_single_click={run_at_ms:_+this.DBLCLICK_MS,target:s,button:c,x:e.x,y:e.y,ev:t}}this.capture_owner=null,this.down_owner=null,this.down_tile=null,this.dragging=!1}),this.key_sink.addEventListener("keydown",t=>{for(let e=this.modules.length-1;e>=0;e--){const a=this.modules[e];if(a&&a.OnGlobalKeyDown){a.OnGlobalKeyDown(t);break}}this.dispatch_global_keydown(t)||this.focused_owner?.OnKeyDown?.(t)}),this.key_sink.addEventListener("keyup",t=>{this.focused_owner?.OnKeyUp?.(t)}),this.key_sink.addEventListener("beforeinput",t=>{if(!this.focused_owner?.OnTextInput)return;t.preventDefault();const e=t.data;typeof e=="string"&&e.length>0&&this.focused_owner.OnTextInput(e)})}tick(){const t=performance.now();if(this.pending_single_click&&t>=this.pending_single_click.run_at_ms){const e=this.pending_single_click;this.pending_single_click=null,e.target.OnClick?.(this.make_pointer_event("click",e.x,e.y,e.ev,this.engine_canvas.get(e.x,e.y),1))}if(ce(this.engine_canvas,this.modules),this.wheel_pending){const{x:e,y:a,delta_mode:s,mods:_}=this.wheel_pending;this.route_to_top_module(e,a)?.OnWheel?.({x:e,y:a,delta_x:this.wheel_accum_dx,delta_y:this.wheel_accum_dy,delta_mode:s,..._}),this.wheel_accum_dx=0,this.wheel_accum_dy=0,this.wheel_pending=null}this.draw_canvas(this.engine_canvas),this.raf_id=requestAnimationFrame(()=>this.tick())}}function be(r){return{id:r.id,rect:r.rect,Draw(t){const e={char:r.char,...r.style!==void 0?{style:r.style}:{},...r.rgb!==void 0?{rgb:r.rgb}:{},...r.weight_index!==void 0?{weight_index:r.weight_index}:{}};t.fill_rect(r.rect,e)}}}function L(r){const t=r.rect;let e=!1,a=!1,s=0;const _=20;function c(i){return i<0?0:i>7?7:i|0}function n(){return r.get_base_weight_index?c(r.get_base_weight_index()):c(r.base_weight_index??3)}function g(){const i=n();let l=0;return s>0?l=2:a?l=-1:e&&(l=1),c(i+l)}function d(i){const l=t.y0+Math.floor((t.y1-t.y0)/2),y=r.label,h=t.x0+Math.max(0,Math.floor((t.x1-t.x0+1-y.length)/2));for(let x=0;x<y.length;x++){const k=h+x;if(k>t.x1)break;const b=y.charAt(x);if(!b)continue;const u=r.get_rgb?r.get_rgb():r.rgb;i.set(k,l,{char:b,rgb:u,style:"regular",weight_index:g()})}}return{id:r.id,rect:t,Focusable:r.Focusable??!0,Draw(i){s>0&&s--;const l=r.get_bg?r.get_bg():r.bg;l&&i.fill_rect(t,{char:l.char,rgb:l.rgb,style:"regular"});const y=r.get_rgb?r.get_rgb():r.rgb;e&&i.set(t.x0,t.y1,{char:"H",rgb:y,style:"regular",weight_index:5}),a&&i.set(t.x0+1,t.y1,{char:"P",rgb:y,style:"regular",weight_index:7}),d(i)},OnPointerEnter(){e=!0},OnPointerLeave(){e=!1},OnPointerDown(i){i.button===0&&(a=!0)},OnPointerUp(){a=!1},OnDragStart(){},OnClick(i){s=_,r.OnPress?.(i)}}}function fe(r,t){return{x0:r.x0+t,y0:r.y0+t,x1:r.x1-t,y1:r.y1-t}}function X(r,t,e,a=3,s={},_={}){const c=s.corner??"+",n=s.h??"-",g=s.v??"|";for(let i=t.x0;i<=t.x1;i++)r.set(i,t.y1,{char:n,rgb:e,style:"regular",weight_index:a}),r.set(i,t.y0,{char:n,rgb:e,style:"regular",weight_index:a});for(let i=t.y0;i<=t.y1;i++)r.set(t.x0,i,{char:g,rgb:e,style:"regular",weight_index:a}),r.set(t.x1,i,{char:g,rgb:e,style:"regular",weight_index:a});r.set(t.x0,t.y0,{char:c,rgb:e,style:"regular",weight_index:a}),r.set(t.x1,t.y0,{char:c,rgb:e,style:"regular",weight_index:a}),r.set(t.x0,t.y1,{char:c,rgb:e,style:"regular",weight_index:a}),r.set(t.x1,t.y1,{char:c,rgb:e,style:"regular",weight_index:a});const d=Math.floor((t.x0+t.x1)/2);return _.top&&r.set(d,t.y1,{char:_.top,rgb:e,style:"regular",weight_index:Math.min(7,a+2)}),_.bottom&&r.set(d,t.y0,{char:_.bottom,rgb:e,style:"regular",weight_index:Math.min(7,a+2)}),fe(t,1)}function W(r,t,e){return Math.max(t,Math.min(e,r))}function ye(r,t){const e=[];if(t<=0||!Array.isArray(r))return e;const a=n=>Array.from(n),s=n=>a(n).length,_=(n,g,d)=>a(n).slice(g,d).join(""),c=(n,g)=>{if(n.length===0){e.push({text:"",sender:g});return}const d=n.split(/\s+/).filter(h=>h.length>0);let i="";const l=()=>{e.push({text:i,sender:g}),i=""},y=h=>{const x=s(h);if(x>t){i.length>0&&l();let b=h;for(;s(b)>t;){const u=Math.max(1,t-1);e.push({text:_(b,0,u)+"-",sender:g}),b=_(b,u)}i=b;return}if(i.length===0){i=h;return}s(i)+1+x<=t?i=i+" "+h:(l(),i=h)};for(const h of d)y(h);d.length===0?e.push({text:"",sender:g}):i.length>0&&e.push({text:i,sender:g})};for(let n=0;n<r.length;n++){const g=r[n]??"",d=typeof g=="string"?g:g.content,i=typeof g=="string"?void 0:g.sender,l=d.split(`
`);for(let y=0;y<l.length;y++)c(l[y]??"",i);n!==r.length-1&&e.push({text:"",sender:i})}return e}function H(r){let t=0,e=-1,a=-1,s=[];function _(){const d=r.base_weight_index??3;return W(d|0,0,7)}function c(d){const i=r.get_source();if(i.rev===e&&d===a)return;const l=U(n()),y=Math.max(0,s.length-l),h=e===-1?!0:t>=y;e=i.rev,a=d,s=ye(i.messages,d);const x=Math.max(0,s.length-l);t=h?x:W(t,0,x)}function n(){return{x0:r.rect.x0+1,y0:r.rect.y0+1,x1:r.rect.x1-1,y1:r.rect.y1-1}}function g(d){const i=n(),l=U(i),y=Math.max(0,s.length-l);t=W(t+d,0,y)}return{id:r.id,rect:r.rect,Focusable:!0,Draw(d){const i=r.border_rgb??o("light_gray").rgb,l=r.text_rgb??o("off_white").rgb,y=r.hint_rgb??o("pale_yellow").rgb,h=_();r.bg&&d.fill_rect(r.rect,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:h});const x=n(),k=B(x),b=U(x);if(k<=0||b<=0){X(d,r.rect,i,h,{corner:"+",h:"-",v:"|"});return}c(k);const u=s.length,f=t>0,v=t+b<u,p={};f&&(p.top="^"),v&&(p.bottom="v"),X(d,r.rect,i,h,{corner:"+",h:"-",v:"|"},p),r.bg?d.fill_rect(x,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:h}):d.fill_rect(x,{char:" ",style:"regular",weight_index:h});for(let E=0;E<b;E++){const A=t+E,T=s[A],R=T?.text??"",m=T?.sender;let P=l;m==="hint"?P=y:m==="npc"?P=r.npc_rgb??l:m==="state"&&(P=r.state_rgb??l);const D=x.y1-E,C=Array.from(R);for(let S=0;S<k;S++){const $=C[S]??" ",I=x.x0+S;d.set(I,D,{char:$,rgb:P,style:"regular",weight_index:h})}}},OnWheel(d){const i=d.delta_y;if(i===0)return;const l=i>0?1:-1;g(l)}}}function j(r,t,e){return Math.max(t,Math.min(e,r))}function J(r,t){const e=[];if(t<=0)return e;const a=g=>Array.from(g),s=g=>a(g).length,_=(g,d,i)=>a(g).slice(d,i).join(""),c=g=>{if(g.length===0){e.push("");return}const d=g.split(/\s+/).filter(h=>h.length>0);let i="";const l=()=>{e.push(i),i=""},y=h=>{const x=s(h);if(x>t){i.length>0&&l();let b=h;for(;s(b)>t;){const u=Math.max(1,t-1);e.push(_(b,0,u)+"-"),b=_(b,u)}i=b;return}if(i.length===0){i=h;return}s(i)+1+x<=t?i=i+" "+h:(l(),i=h)};for(const h of d)y(h);d.length===0?e.push(""):i.length>0&&e.push(i)},n=r.split(`
`);for(const g of n)c(g??"");return e}function xe(r){const t=r.text_rgb??o("off_white").rgb,e=r.border_rgb??o("light_gray").rgb,a=r.cursor_rgb??o("off_white").rgb,s=typeof r.base_weight_index=="number"?j(Math.trunc(r.base_weight_index),0,7):3;let _=!1,c="";function n(){const l=Array.from(c);l.length!==0&&(l.pop(),c=l.join(""),r.on_change?.(c))}function g(l){const y=l.replace(/\t/g,"    ");c=c+y,r.on_change?.(c)}function d(){const l=c;l.length!==0&&(r.on_submit(r.target_id,l),c="",r.on_change?.(c))}function i(l,y,h){l.set(y,h,{char:"â–Œ",rgb:a,style:"regular",weight_index:s})}return r.bind_submit?.(d),{id:r.id,rect:r.rect,Focusable:!0,OnFocus(){_=!0},OnBlur(){_=!1},OnPointerDown(l){},OnTextInput(l){_&&l&&g(l)},OnKeyDown(l){if(_){if(l.key==="Backspace"){l.preventDefault(),l.stopPropagation(),n();return}if(l.key==="Enter"){l.preventDefault(),l.stopPropagation(),l.shiftKey?g(`
`):d();return}}},Draw(l){const y=r.rect,h={x0:y.x0+1,y0:y.y0+1,x1:y.x1-1,y1:y.y1-1};r.bg&&l.fill_rect(y,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:s}),X(l,y,e);const x=B(h),k=U(h),b=c.length>0?c:r.placeholder??"",u=J(b,x),f=Math.max(0,u.length-k);r.bg?l.fill_rect(h,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:s}):l.fill_rect(h,{char:" ",style:"regular",weight_index:s});for(let v=0;v<k;v++){const p=u[f+v]??"",E=Array.from(p),A=h.y1-v;for(let T=0;T<x;T++){const R=E[T]??" ",m=c.length===0&&(r.placeholder??"").length>0;l.set(h.x0+T,A,{char:R,rgb:m?o("medium_gray").rgb:t,style:"regular",weight_index:s})}}if(_){const v=J(c,x),p=Math.max(0,v.length-k),E=Math.max(0,v.length-1),A=j(E-p,0,k-1),T=v[E]??"",R=h.y1-A,m=h.x0+j(Array.from(T).length,0,x-1);i(l,m,R)}}}}function we(r,t,e){return Math.max(t,Math.min(e,r))}function me(r){let t=!1,e=!1;function a(){const n=r.base_weight_index??3;return we(n|0,0,7)}function s(n,g,d,i,l,y){const h=Array.from(i);for(let x=0;x<h.length;x++){const k=h[x]??" ";n.set(g+x,d,{char:k,rgb:l,style:"regular",weight_index:y})}}function _(){return{x0:r.rect.x0+1,y0:r.rect.y0+1,x1:r.rect.x1-1,y1:r.rect.y0+3}}function c(n,g,d){return g>=n.x0&&g<=n.x1&&d>=n.y0&&d<=n.y1}return{id:r.id,rect:r.rect,Focusable:!0,Draw(n){const g=r.get_state(),d=a(),i=r.rect;r.bg&&n.fill_rect(i,{char:r.bg.char,rgb:r.bg.rgb,style:"regular",weight_index:d});const l=g.disabled?r.dim_rgb:r.text_rgb,y=g.disabled?":3":g.dice_label,h=g.last_roll.length>0?g.last_roll:"no roll",x=g.spinner||"|";s(n,i.x0+1,i.y1-1,`roll ${x}`,l,d+1);const k=B(i)-2,b=h.length>k?h.slice(0,k):h;s(n,i.x0+1,i.y1-2,b,l,d);const u=_(),f=g.disabled?r.dim_rgb:r.text_rgb;n.fill_rect(u,{char:"-",rgb:r.border_rgb,style:"regular",weight_index:d});const v=y,p=u.x0+Math.max(0,Math.floor((B(u)-v.length)/2)),E=u.y0+Math.floor(U(u)/2),A=g.disabled?0:d+(t?1:0);s(n,p,E,v,f,A),e&&n.set(u.x0,u.y1,{char:"P",rgb:f,style:"regular",weight_index:d+2})},OnPointerEnter(){t=!0},OnPointerLeave(){t=!1,e=!1},OnPointerDown(n){n.button===0&&c(_(),n.x,n.y)&&(e=!0)},OnPointerUp(){e=!1},OnClick(n){if(n.button!==0)return;const g=r.get_state();g.disabled||!g.roll_id||c(_(),n.x,n.y)&&r.on_roll(g.roll_id)}}}function pe(r){return(r??"").toLowerCase().split(/[^a-z0-9]+/g).map(e=>e.trim()).filter(e=>e.length>0)}function ve(r,t){const e=[];for(let a=2;a<=t;a++)for(let s=0;s+a<=r.length;s++)e.push(r.slice(s,s+a).join(" "));return e}const ke=[{verb:"COMMUNICATE",keywords:["say","ask","tell","speak","talk","hello","hi","hey","greet","whisper","shout","yell","signal"],phrases:["talk to","speak to","ask about"]},{verb:"INSPECT",keywords:["inspect","look","examine","search","scan","survey","check","observe"],phrases:["look around","look at","examine the"]},{verb:"MOVE",keywords:["move","go","walk","run","travel","head","approach","enter","leave","north","south","east","west"],phrases:["go to","walk to","head to"]},{verb:"ATTACK",keywords:["attack","hit","strike","stab","shoot","kill","punch","slash","swing"],phrases:["attack the","hit the"]},{verb:"USE",keywords:["use","light","ignite","drink","eat","equip","unequip","wield","wear","consume"],phrases:["pick up","put on"]},{verb:"HELP",keywords:["help","assist","aid"]},{verb:"DEFEND",keywords:["defend","block","parry"]},{verb:"DODGE",keywords:["dodge","evade","duck"]},{verb:"GRAPPLE",keywords:["grapple","grab","wrestle"]},{verb:"CRAFT",keywords:["craft","make","build","forge","brew"]},{verb:"SLEEP",keywords:["sleep","rest","nap"]},{verb:"REPAIR",keywords:["repair","fix","mend"]},{verb:"WORK",keywords:["work","labor"]},{verb:"GUARD",keywords:["guard","watch"]},{verb:"HOLD",keywords:["hold","ready","prepare"]}];function Q(r){const t=pe(r);if(t.length===0)return{verb:null};const e=new Set(t),a=ve(t,3),s=new Set(a),_=[];for(const i of ke){if(Array.isArray(i.phrases))for(const l of i.phrases)s.has(l)&&_.push({verb:i.verb,score:3,matched:l,mode:"phrase"});for(const l of i.keywords)e.has(l)&&_.push({verb:i.verb,score:2,matched:l,mode:"token"})}if(_.length===0)return{verb:null};_.sort((i,l)=>l.score-i.score);const c=_[0],n=c.score,g=_.filter(i=>i.score===n),d=Array.from(new Set(g.map(i=>i.verb)));return d.length>1?{verb:null,ambiguous:!0,candidates:d.map(i=>{const l=g.find(y=>y.verb===i);return{verb:i,score:l.score,matched:l.matched}})}:{verb:c.verb,matched_keyword:c.matched,matched_mode:c.mode}}const M={font_family:"Martian Mono",base_font_size_px:10,base_line_height_mult:1.5,base_letter_spacing_mult:.08,weight_index_to_css:[100,200,300,400,500,600,700,800],grid_width:120,grid_height:44,interpreter_endpoint:"http://localhost:8787/api/input",interpreter_log_endpoint:"http://localhost:8787/api/log",interpreter_status_endpoint:"http://localhost:8787/api/status",interpreter_targets_endpoint:"http://localhost:8787/api/targets",roller_status_endpoint:"http://localhost:8787/api/roller_status",roller_roll_endpoint:"http://localhost:8787/api/roll",selected_data_slot:1,input_actor_id:"henry_actor"};function Ee(){const r=o("off_white").rgb,t=o("deep_red").rgb,e={text_windows:new Map,status_override:{until_ms:0,lines:[]},controls:{override_intent:null,override_cost:null,selected_target:null,draft:"",suggested_intent:null,suggested_matched:null,last_infer_timer:null,targets:[],region_label:null,targets_ready:!1},roller:{spinner:"|",last_roll:"",dice_label:"D20",disabled:!0,roll_id:null}};function a(b,u){const f=e.text_windows.get(b);f?(f.messages=[...u],f.rev++):e.text_windows.set(b,{messages:[...u],rev:1})}function s(b,u){const f=e.text_windows.get(b);f?(f.messages.push(u),f.rev++):e.text_windows.set(b,{messages:[u],rev:1})}const _=[],c=new Map;function n(b,u){e.status_override.until_ms=Date.now()+u,e.status_override.lines=[...b];const f=e.text_windows.get("status");f&&f.rev++}function g(b){_.push(b)}async function d(){const b=_.map(async u=>{try{const f=await u.fetch_messages();a(u.window_id,f)}catch(f){V("[mono_ui] failed to refresh window feed",u.window_id,f)}});b.push((async()=>{try{const u=await fetch(M.roller_status_endpoint);if(!u.ok)return;const f=await u.json();if(!f.ok||!f.status)return;e.roller.spinner=String(f.status.spinner??"|"),e.roller.last_roll=String(f.status.last_player_roll??""),e.roller.dice_label=String(f.status.dice_label??"D20"),e.roller.disabled=!!(f.status.disabled??!0),e.roller.roll_id=f.status.roll_id??null}catch{}})()),b.push((async()=>{try{const u=`${M.interpreter_targets_endpoint}?slot=${M.selected_data_slot}&actor_id=${M.input_actor_id}`,f=await fetch(u);if(!f.ok)return;const v=await f.json();if(!v.ok)return;e.controls.targets=Array.isArray(v.targets)?v.targets:[],e.controls.region_label=typeof v.region=="string"?v.region:null,e.controls.targets_ready=!0,e.controls.selected_target&&(e.controls.targets.some(R=>R.ref.toLowerCase()===e.controls.selected_target.toLowerCase())||(e.controls.selected_target=null,n(["target no longer valid (choose again)"],1200)));const p=[];p.push(`[region] ${e.controls.region_label??"unknown"}`);const E=e.controls.override_intent??e.controls.suggested_intent;E?p.push(`[intent] ${E}`):p.push("[intent] (none)");const A=e.controls.override_cost;p.push(`[cost] ${A??"(auto)"}`),e.controls.selected_target?p.push(`[target] ${e.controls.selected_target}`):p.push("[target] (none)"),p.push(""),p.push("Targets (type @name or /target name):");for(const T of e.controls.targets)T.type==="npc"&&p.push(`- ${T.label} (${T.ref})`);a("targets",p)}catch{}})()),await Promise.all(b)}function i(b){d(),setInterval(()=>{d()},b)}async function l(b){try{let u=function(O){const D=A(O);if(!D)return null;const C=T.find(S=>{const $=A(S.label),I=A(S.ref.replace(/^npc\./i,""));return $===D||I===D});return C?{ref:C.ref,label:C.label}:null};e.controls.targets_ready||(n(["loading targets..."],800),await new Promise(O=>setTimeout(O,250)));const f=b.trim();if(f.toLowerCase().startsWith("/target ")){const O=f.slice(8).trim().toLowerCase(),D=e.controls.targets.find(C=>C.type==="npc"&&(C.label.toLowerCase()===O||C.ref.toLowerCase()===`npc.${O}`));e.controls.selected_target=D?D.ref:null,n([`target set: ${D?D.label:"(cleared)"}`],1200);return}if(f.toLowerCase()==="/target"){e.controls.selected_target=null,n(["target cleared"],1200);return}let v=e.controls.selected_target,p=b;const E=f.split(/\s+/).filter(O=>O.length>0),A=O=>O.toLowerCase().replace(/[^a-z0-9]/g,""),T=e.controls.targets.filter(O=>O.type==="npc");for(let O=0;O<E.length;O++){const D=E[O]??"";if(!D.startsWith("@")||D.length<2)continue;const C=D.slice(1),S=E[O+1],$=E[O+2],I=[];I.push(C),S&&I.push(`${C} ${S}`),S&&$&&I.push(`${C} ${S} ${$}`);let N=null;for(const ne of I)if(N=u(ne),N)break;N?(v=N.ref,e.controls.selected_target=N.ref,E[O]=C,p=E.join(" "),n([`target: ${N.label}`],800)):n([`unknown target: ${C} (pick from targets panel)`],1200);break}v&&(e.controls.targets.some(D=>D.ref.toLowerCase()===v.toLowerCase())||(e.controls.selected_target=null,v=null,n(["target no longer valid (choose again)"],1200)));const R=Q(p);!e.controls.override_intent&&!R.verb&&(n(["your message does not contain an action type hint"],900),await new Promise(O=>setTimeout(O,900)));const m=await fetch(M.interpreter_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:p,sender:M.input_actor_id,intent_verb:e.controls.override_intent??void 0,action_cost:e.controls.override_cost??void 0,target_ref:v??void 0})});if(!m.ok)throw new Error(`HTTP ${m.status}`);const P=await m.json();P.ok&&P.id&&(c.set(P.id,b),d()),n(["waiting for actor response"],900)}catch(u){V("[mono_ui] failed to send to interpreter",u),s("log","[system] failed to reach interpreter")}}async function y(b){const u=await fetch(`${M.interpreter_log_endpoint}?slot=${b}`);if(!u.ok)throw new Error(`HTTP ${u.status}`);const f=await u.json();if(!f.ok||!Array.isArray(f.messages))return[];const v=[...f.messages].reverse(),p=new Set,E=new Map,A=v.filter(m=>{if(!m?.id||p.has(m.id))return!1;p.add(m.id);const P=(m.sender??"").toLowerCase();if(P==="j")return!0;if(P==="renderer_ai"){const O=m.correlation_id??"none",D=(m.content??"").trim(),C=E.get(O);return E.set(O,D),!(!D||C!==void 0&&C===D)}return!!(P==="hint"||m.type==="user_input"||P.startsWith("npc.")||P==="state_applier")});for(const m of A)c.has(m.id)&&c.delete(m.id);const T=A.map(m=>{const P=(m.sender??"").toLowerCase();return P==="hint"?{content:`ðŸ’¡ ${m.content}`,sender:"hint"}:P==="renderer_ai"?{content:`ASSISTANT: ${m.content}`,sender:"assistant"}:P==="j"?{content:`J: ${m.content}`,sender:"user"}:P.startsWith("npc.")?{content:`${P.replace("npc.","").toUpperCase()}: ${m.content}`,sender:"npc"}:P==="state_applier"?{content:`[STATE] ${m.content}`,sender:"state"}:{content:`${m.sender}: ${m.content}`,sender:"system"}}),R=Array.from(c.values()).map(m=>({content:`J: ${m}`,sender:"user"}));return[...T,...R]}async function h(b){if(e.status_override.until_ms>Date.now()&&e.status_override.lines.length>0)return[...e.status_override.lines];const u=await fetch(`${M.interpreter_status_endpoint}?slot=${b}`);if(!u.ok)throw new Error(`HTTP ${u.status}`);const f=await u.json();return!f.ok||!f.status?.line?[""]:[f.status.line]}window.THAUM_UI={set_text_window_messages:a,append_text_window_message:s},a("log",["This is a text window. It wraps words onto new lines.","If a word is tooooooooolongtobefitononeline it will hyphenate-and-continue.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","Scroll with the mouse wheel if there is more text.","hey! :3"]);let x=null;const k=[be({id:"bg",rect:{x0:0,y0:0,x1:M.grid_width-1,y1:M.grid_height-1},char:".",rgb:t,style:"regular"}),H({id:"log",rect:{x0:1,y0:13,x1:86,y1:36},get_source:()=>e.text_windows.get("log")??{messages:[],rev:0},border_rgb:o("light_gray").rgb,text_rgb:o("off_white").rgb,bg:{char:" ",rgb:o("off_black").rgb},base_weight_index:3,hint_rgb:o("pale_yellow").rgb,npc_rgb:o("pumpkin").rgb,state_rgb:o("dark_gray").rgb}),H({id:"status",rect:{x0:1,y0:38,x1:86,y1:42},get_source:()=>e.text_windows.get("status")??{messages:[],rev:0},border_rgb:o("medium_gray").rgb,text_rgb:o("pale_gray").rgb,bg:{char:" ",rgb:o("off_black").rgb},base_weight_index:3}),xe({id:"input",rect:{x0:1,y0:1,x1:86,y1:11},target_id:"log",on_submit:(b,u)=>{l(u)},on_change:b=>{e.controls.draft=b,e.controls.last_infer_timer&&clearTimeout(e.controls.last_infer_timer),e.controls.last_infer_timer=window.setTimeout(()=>{const u=Q(e.controls.draft);e.controls.suggested_intent=u.verb?u.verb:null,e.controls.suggested_matched=u.matched_keyword??null;const f=[];f.push(`[suggested] ${e.controls.suggested_intent??"(none)"}`),e.controls.suggested_matched&&f.push(`[matched] ${e.controls.suggested_matched}`),f.push(`[override intent] ${e.controls.override_intent??"(none)"}`),f.push(`[override cost] ${e.controls.override_cost??"(none)"}`),a("controls",f)},1e3)},bind_submit:b=>{x=b},border_rgb:o("light_gray").rgb,text_rgb:o("off_white").rgb,cursor_rgb:o("off_white").rgb,bg:{char:" ",rgb:o("off_black").rgb},base_weight_index:3,placeholder:"Typeâ€¦ (Enter=send, Shift+Enter=new line, Backspace=delete)"}),L({id:"btn_send",rect:{x0:88,y0:1,x1:100,y1:3},label:"send",rgb:o("pale_orange").rgb,bg:{char:"-",rgb:o("dark_gray").rgb},OnPress(){x?.()}}),H({id:"controls",rect:{x0:88,y0:4,x1:118,y1:11},get_source:()=>e.text_windows.get("controls")??{messages:[],rev:0},border_rgb:o("medium_gray").rgb,text_rgb:o("pale_gray").rgb,bg:{char:" ",rgb:o("off_black").rgb},base_weight_index:3}),H({id:"targets",rect:{x0:88,y0:20,x1:118,y1:36},get_source:()=>e.text_windows.get("targets")??{messages:[],rev:0},border_rgb:o("light_gray").rgb,text_rgb:o("off_white").rgb,bg:{char:" ",rgb:o("off_black").rgb},base_weight_index:3}),L({id:"cost_free",rect:{x0:102,y0:1,x1:106,y1:3},label:"FREE",rgb:o("pale_orange").rgb,bg:{char:".",rgb:o("dark_gray").rgb},OnPress(){e.controls.override_cost="FREE",n(["action cost: FREE"],800)}}),L({id:"cost_part",rect:{x0:107,y0:1,x1:112,y1:3},label:"PART",rgb:o("pale_orange").rgb,bg:{char:".",rgb:o("dark_gray").rgb},OnPress(){e.controls.override_cost="PARTIAL",n(["action cost: PARTIAL"],800)}}),L({id:"cost_full",rect:{x0:113,y0:1,x1:118,y1:3},label:"FULL",rgb:o("pale_orange").rgb,bg:{char:".",rgb:o("dark_gray").rgb},OnPress(){e.controls.override_cost="FULL",n(["action cost: FULL"],800)}}),L({id:"cost_ext",rect:{x0:113,y0:4,x1:118,y1:6},label:"EXT",rgb:o("pale_orange").rgb,bg:{char:".",rgb:o("dark_gray").rgb},OnPress(){e.controls.override_cost="EXTENDED",n(["action cost: EXTENDED"],800)}}),L({id:"verb_use",rect:{x0:88,y0:7,x1:93,y1:9},label:"USE",rgb:r,get_rgb:()=>e.controls.override_intent==="USE"?o("pale_yellow").rgb:e.controls.suggested_intent==="USE"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="USE",n(["intent: USE"],800)}}),L({id:"verb_atk",rect:{x0:94,y0:7,x1:99,y1:9},label:"ATK",rgb:r,get_rgb:()=>e.controls.override_intent==="ATTACK"?o("pale_yellow").rgb:e.controls.suggested_intent==="ATTACK"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="ATTACK",n(["intent: ATTACK"],800)}}),L({id:"verb_hlp",rect:{x0:100,y0:7,x1:105,y1:9},label:"HLP",rgb:r,get_rgb:()=>e.controls.override_intent==="HELP"?o("pale_yellow").rgb:e.controls.suggested_intent==="HELP"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="HELP",n(["intent: HELP"],800)}}),L({id:"verb_def",rect:{x0:106,y0:7,x1:112,y1:9},label:"DEF",rgb:r,get_rgb:()=>e.controls.override_intent==="DEFEND"?o("pale_yellow").rgb:e.controls.suggested_intent==="DEFEND"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="DEFEND",n(["intent: DEFEND"],800)}}),L({id:"verb_grp",rect:{x0:113,y0:7,x1:118,y1:9},label:"GRP",rgb:r,get_rgb:()=>e.controls.override_intent==="GRAPPLE"?o("pale_yellow").rgb:e.controls.suggested_intent==="GRAPPLE"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="GRAPPLE",n(["intent: GRAPPLE"],800)}}),L({id:"verb_ins",rect:{x0:88,y0:10,x1:93,y1:12},label:"INS",rgb:r,get_rgb:()=>e.controls.override_intent==="INSPECT"?o("pale_yellow").rgb:e.controls.suggested_intent==="INSPECT"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="INSPECT",n(["intent: INSPECT"],800)}}),L({id:"verb_com",rect:{x0:94,y0:10,x1:101,y1:12},label:"COM",rgb:r,get_rgb:()=>e.controls.override_intent==="COMMUNICATE"?o("pale_yellow").rgb:e.controls.suggested_intent==="COMMUNICATE"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="COMMUNICATE",n(["intent: COMMUNICATE"],800)}}),L({id:"verb_mov",rect:{x0:102,y0:10,x1:107,y1:12},label:"MOV",rgb:r,get_rgb:()=>e.controls.override_intent==="MOVE"?o("pale_yellow").rgb:e.controls.suggested_intent==="MOVE"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="MOVE",n(["intent: MOVE"],800)}}),L({id:"verb_ddg",rect:{x0:108,y0:10,x1:112,y1:12},label:"DDG",rgb:r,get_rgb:()=>e.controls.override_intent==="DODGE"?o("pale_yellow").rgb:e.controls.suggested_intent==="DODGE"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="DODGE",n(["intent: DODGE"],800)}}),L({id:"verb_crf",rect:{x0:113,y0:10,x1:118,y1:12},label:"CRF",rgb:r,get_rgb:()=>e.controls.override_intent==="CRAFT"?o("pale_yellow").rgb:e.controls.suggested_intent==="CRAFT"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="CRAFT",n(["intent: CRAFT"],800)}}),L({id:"verb_slp",rect:{x0:88,y0:13,x1:93,y1:15},label:"SLP",rgb:r,get_rgb:()=>e.controls.override_intent==="SLEEP"?o("pale_yellow").rgb:e.controls.suggested_intent==="SLEEP"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="SLEEP",n(["intent: SLEEP"],800)}}),L({id:"verb_rpr",rect:{x0:94,y0:13,x1:99,y1:15},label:"RPR",rgb:r,get_rgb:()=>e.controls.override_intent==="REPAIR"?o("pale_yellow").rgb:e.controls.suggested_intent==="REPAIR"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="REPAIR",n(["intent: REPAIR"],800)}}),L({id:"verb_wrk",rect:{x0:100,y0:13,x1:105,y1:15},label:"WRK",rgb:r,get_rgb:()=>e.controls.override_intent==="WORK"?o("pale_yellow").rgb:e.controls.suggested_intent==="WORK"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="WORK",n(["intent: WORK"],800)}}),L({id:"verb_grd",rect:{x0:106,y0:13,x1:112,y1:15},label:"GRD",rgb:r,get_rgb:()=>e.controls.override_intent==="GUARD"?o("pale_yellow").rgb:e.controls.suggested_intent==="GUARD"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="GUARD",n(["intent: GUARD"],800)}}),L({id:"verb_hld",rect:{x0:113,y0:13,x1:118,y1:15},label:"HLD",rgb:r,get_rgb:()=>e.controls.override_intent==="HOLD"?o("pale_yellow").rgb:e.controls.suggested_intent==="HOLD"?o("pale_gray").rgb:o("dark_gray").rgb,bg:{char:"-",rgb:o("off_black").rgb},OnPress(){e.controls.override_intent="HOLD",n(["intent: HOLD"],800)}}),L({id:"verb_clear",rect:{x0:88,y0:16,x1:99,y1:18},label:"CLEAR",rgb:o("pale_yellow").rgb,bg:{char:".",rgb:o("dark_gray").rgb},OnPress(){e.controls.override_intent=null,e.controls.override_cost=null,n(["overrides cleared"],800)}}),me({id:"roller",rect:{x0:88,y0:38,x1:118,y1:42},get_state:()=>e.roller,on_roll:async b=>{await fetch(M.roller_roll_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roll_id:b})})},text_rgb:o("pale_orange").rgb,dim_rgb:o("medium_gray").rgb,border_rgb:o("dark_gray").rgb,bg:{char:" ",rgb:o("off_black").rgb},base_weight_index:3})];return g({window_id:"log",fetch_messages:()=>y(M.selected_data_slot)}),g({window_id:"status",fetch_messages:()=>h(M.selected_data_slot)}),a("controls",["[suggested] (none)","[override intent] (none)","[override cost] (none)"]),a("targets",["[region] (loading...)","Targets will appear here."]),{modules:k,start_window_feed_polling:i}}const re=document.getElementById("mono_canvas");if(!re)throw new Error("mono_canvas element not found");const{modules:Oe,start_window_feed_polling:Pe}=Ee(),F=new ue({canvas:re,grid_width:M.grid_width,grid_height:M.grid_height,font_family:M.font_family,base_font_size_px:M.base_font_size_px,base_line_height_mult:M.base_line_height_mult,base_letter_spacing_mult:M.base_letter_spacing_mult,weight_index_to_css:M.weight_index_to_css,modules:Oe});Pe(1e3);F.start();window.addEventListener("keydown",r=>{r.key==="1"&&F.set_scale(.5),r.key==="2"&&F.set_scale(1),r.key==="3"&&F.set_scale(1.5),r.key==="4"&&F.set_scale(2)});
